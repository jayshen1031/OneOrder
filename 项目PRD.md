⸻

项目PRD：清分规则与系统实现

一、项目背景

在当前业务模式下，涉及客户、销售站、交付站、供应商及不同法人的复杂收付场景。
现有系统在清分、借抬头、过账、分润计算等环节存在以下问题：
	•	管理报表与法定报表口径不一致。
	•	借抬头与过账逻辑未完全系统化，部分依赖人工判断。
	•	现有系统无法自动完成链式转新式的资金流转处理，存在“空转”风险。

项目目标是通过规则引擎化、系统自动化，支撑复杂场景下的清分和资金流追踪。

⸻

二、目标与范围

项目目标
	1.	实现订单 → 服务 → 部门/法人的全流程自动清分。
	2.	支持链式和新式两种模式的资金流计算，避免空转问题。
	3.	输出两套结果：
	•	管理报表（毛利、内部收支、分润清晰）
	•	法定报表（法人维度一致，满足税务合规）

项目范围
	•	订单与服务的分解、下派机制。
	•	借抬头（收款借抬头、付款借抬头）的系统化处理。
	•	过账逻辑与规则引擎（平收平付、抵消、不同区域玩法）。
	•	分润计算（五五开、定比例、定额）。
	•	管理报表与法定报表的双轨输出。

⸻

三、业务场景分析

1. 标准模式
	•	客户 → 销售法人 → 交付法人 → 供应商法人
	•	客户付款金额 = 收入
	•	供应商付款金额 = 成本
	•	毛利 = 收入 - 成本
	•	分润：销售、交付双方按规则分成（如五五开）。

2. 借抬头模式
	•	收款借抬头：客户先付至中间法人，再流转至销售法人。
	•	付款借抬头：销售法人先付至中间法人，再由中间法人支付给供应商。
	•	借抬头法人留存固定比例（如3%）。

3. 过账模式
	•	典型场景：宁波公司付款 → 泰国公司收款，需过账香港公司。
	•	特殊规则：
	•	平收平付 / 抵消
	•	同一法人下的多笔收付，是否抵消

4. 链式与星式
	•	链式：按实际派单路径逐层清分，可能出现资金空转。
	•	星式：以收款法人为总包，直接对销售、交付、付款法人进行分润，避免空转。

⸻

四、核心功能需求

1. 订单与服务管理
	•	支持一个订单包含多个服务。
	•	服务可下派至不同部门或法人。

2. 收付款与清分规则
	•	系统根据预设规则自动清分（借抬头、过账、分润）。
	•	支持链式和星式两种算法，按场景切换。

3. 报表输出
	•	管理报表：外收、外支、内收、内支、毛利。
	•	法定报表：法人对外收支、分润结果。

4. 参数化配置
	•	借抬头费率（如3%）可配置。
	•	分润规则（五五开/比例/定额）可配置。
	•	过账规则按币种、区域、法人关系配置。

⸻

五、非功能需求
	•	性能：支持日均上千单的实时清分计算。
	•	可扩展性：后续支持税务模块、跨币种汇兑差额。
	•	可维护性：规则引擎化，便于调整。
	•	安全性：保证跨法人、跨部门资金流可追踪。

⸻

六、交付物
	1.	清分逻辑引擎（含链式/星式切换）。
	2.	借抬头与过账处理模块。
	3.	报表生成（管理报表、法定报表）。
	4.	配置化后台（规则参数管理）。

⸻

七、里程碑计划
	1.	需求分析 & 原型设计（2周）
	2.	规则引擎开发（4周）
	3.	借抬头与过账模块开发（4周）
	4.	报表模块开发（3周）
	5.	系统集成 & UAT测试（3周）
	6.	上线 & 培训（2周）

⸻

八、风险与对策
	•	资金空转风险 → 新式逻辑替代链式，优化路径。
	•	规则复杂性高 → 引入规则引擎，参数化配置。
	•	管理口径与财务口径不一致 → 双轨输出（管报 & 法报）。
	•	跨法人税务差异 → 后续版本引入税务模块。

⸻