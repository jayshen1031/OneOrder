# OneOrderæ¥æ´¾å•æµç¨‹å®æ–½æ–¹æ¡ˆ

## 1. éœ€æ±‚åˆ†æ

### 1.1 ä¸šåŠ¡æµç¨‹æ¦‚è¿°
å®ç°å®Œæ•´çš„å®¢æœæ¥å•â†’æ´¾å•â†’æ“ä½œæ¥å•â†’åè®®ç¡®è®¤çš„ä¸šåŠ¡æµç¨‹ï¼Œæ”¯æŒï¼š
- å®¢æœä½œä¸ºè®¢å•è´Ÿè´£äººæ¥å•
- å¤šæœåŠ¡é¡¹çš„çµæ´»æ´¾å•  
- å†…éƒ¨åè®®çš„æ™ºèƒ½åŒ¹é…å’Œç¡®è®¤
- æ“ä½œäººå‘˜çš„ä¸»åŠ¨æ¥å•ç¡®è®¤
- åŸºäºåè®®çš„åˆ†æ¶¦è®¡ç®—å‡†å¤‡

### 1.2 æ ¸å¿ƒä¸šåŠ¡è§„åˆ™
1. **è®¢å•è´Ÿè´£åˆ¶**: å®¢æœåˆ›å»ºè®¢å•åè‡ªåŠ¨æˆä¸ºè®¢å•è´Ÿè´£äºº
2. **æœåŠ¡æ´¾å•åˆ¶**: æ¯ä¸ªæœåŠ¡å¿…é¡»æŒ‡æ´¾ç»™å…·ä½“æ“ä½œäººå‘˜
3. **åè®®ç¡®è®¤åˆ¶**: æ“ä½œäººå‘˜æ¥å•æ—¶å¿…é¡»ç¡®è®¤å†…éƒ¨åè®®
4. **åˆ†æ¶¦ä¾æ®åˆ¶**: åè®®ç¡®è®¤åæ‰èƒ½è¿›è¡Œåˆ†æ¶¦è®¡ç®—

## 2. ç°æœ‰ç³»ç»Ÿåˆ†æ

### 2.1 å·²æœ‰åŠŸèƒ½æ¨¡å—
âœ… **è®¢å•ç®¡ç†**: å®Œæ•´çš„è®¢å•CRUDå’ŒçŠ¶æ€ç®¡ç†
âœ… **æ¸…åˆ†å¼•æ“**: æ˜Ÿå¼/é“¾å¼æ¸…åˆ†å’ŒéªŒè¯æœºåˆ¶  
âœ… **å†…éƒ¨åè®®**: åè®®åŒ¹é…å’Œç®¡ç†åŠŸèƒ½
âœ… **å‘˜å·¥ç®¡ç†**: Staffå®ä½“å’Œéƒ¨é—¨æƒé™ç®¡ç†
âœ… **æœåŠ¡é…ç½®**: 188ä¸ªè´¹ç”¨ç§‘ç›®çš„å®Œæ•´é…ç½®

### 2.2 éœ€è¦å¢å¼ºçš„æ¨¡å—
ğŸ”§ **ç”¨æˆ·è§’è‰²**: åŒºåˆ†å®¢æœ(CUSTOMER_SERVICE)å’Œæ“ä½œ(OPERATION)è§’è‰²
ğŸ”§ **æ´¾å•å·¥ä½œæµ**: OrderServiceå®ä½“å¢åŠ æ´¾å•çŠ¶æ€ç®¡ç†
ğŸ”§ **æ¶ˆæ¯é€šçŸ¥**: æ´¾å•é€šçŸ¥å’Œæ¥å•ç¡®è®¤æœºåˆ¶
ğŸ”§ **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„åŠŸèƒ½æƒé™ç®¡ç†

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 ç”¨æˆ·è§’è‰²æšä¸¾å¢å¼º

```java
// Staff.java - å¢åŠ è§’è‰²ç±»å‹
public enum RoleType {
    CUSTOMER_SERVICE("å®¢æœ"),      // æ–°å¢ï¼šå®¢æœè§’è‰²
    OPERATION("æ“ä½œäººå‘˜"),         // ç°æœ‰ï¼šæ“ä½œäººå‘˜
    MANAGER("ä¸»ç®¡"),              // ç°æœ‰ï¼šä¸»ç®¡
    ADMIN("ç®¡ç†å‘˜")               // ç°æœ‰ï¼šç®¡ç†å‘˜
}
```

### 3.2 è®¢å•æœåŠ¡çŠ¶æ€ä¼˜åŒ–

```java
// OrderService.java - ä¼˜åŒ–æœåŠ¡çŠ¶æ€
public enum ServiceStatus {
    PENDING("å¾…æ´¾å•"),            // æœåŠ¡å·²é€‰æ‹©ï¼Œå¾…å®¢æœæ´¾å•
    ASSIGNED("å·²æ´¾å•"),           // å®¢æœå·²æ´¾å•ï¼Œå¾…æ“ä½œäººå‘˜æ¥å•
    PROTOCOL_CONFIRMED("åè®®å·²ç¡®è®¤"), // æ“ä½œäººå‘˜å·²æ¥å•å¹¶ç¡®è®¤åè®®
    IN_PROGRESS("æ‰§è¡Œä¸­"),        // æ“ä½œäººå‘˜å¼€å§‹æ‰§è¡ŒæœåŠ¡
    COMPLETED("å·²å®Œæˆ"),          // æœåŠ¡æ‰§è¡Œå®Œæˆ
    BLOCKED("å—é˜»")              // æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜
}
```

### 3.3 æ–°å¢æ´¾å•é€šçŸ¥å®ä½“

```java
@Entity
@Table(name = "service_assignment_notification")
public class ServiceAssignmentNotification {
    private Long notificationId;
    private String orderId;
    private Long serviceId;
    private String fromStaffId;      // æ´¾å•äºº(å®¢æœ)
    private String toStaffId;        // è¢«æ´¾å•äºº(æ“ä½œ)
    private String protocolId;       // é€‰å®šçš„å†…éƒ¨åè®®
    private String message;          // æ´¾å•è¯´æ˜
    private NotificationStatus status; // é€šçŸ¥çŠ¶æ€
    private LocalDateTime sentTime;  // å‘é€æ—¶é—´
    private LocalDateTime readTime;  // é˜…è¯»æ—¶é—´
    private LocalDateTime confirmedTime; // ç¡®è®¤æ—¶é—´
}
```

## 4. åŠŸèƒ½å®ç°æ–¹æ¡ˆ

### 4.1 å®¢æœæ¥å•åŠŸèƒ½

#### 4.1.1 å¢å¼ºè®¢å•åˆ›å»ºæ¥å£
```java
@PostMapping("/orders/create-with-services")
public ResponseEntity<OrderCreationResponse> createOrderWithServices(
    @RequestBody OrderCreationRequest request) {
    
    // 1. éªŒè¯å®¢æœæƒé™
    Staff customerService = validateCustomerServiceRole(request.getCustomerServiceId());
    
    // 2. åˆ›å»ºè®¢å•
    Order order = createOrder(request);
    order.setResponsibleStaffId(request.getCustomerServiceId()); // å®¢æœæˆä¸ºè´Ÿè´£äºº
    
    // 3. æ ¹æ®ä¸šåŠ¡ç±»å‹åŠ è½½å¯é€‰æœåŠ¡
    List<ServiceConfig> availableServices = 
        serviceConfigService.getServicesByBusinessType(request.getBusinessType());
    
    // 4. åˆ›å»ºé€‰å®šçš„æœåŠ¡é¡¹
    for (String serviceCode : request.getSelectedServices()) {
        OrderService orderService = new OrderService();
        orderService.setOrderId(order.getOrderId());
        orderService.setServiceCode(serviceCode);
        orderService.setStatus(ServiceStatus.PENDING); // å¾…æ´¾å•çŠ¶æ€
        orderService.setCreatedBy(request.getCustomerServiceId());
        orderServiceRepository.save(orderService);
    }
    
    return ResponseEntity.ok(new OrderCreationResponse(order, availableServices));
}
```

#### 4.1.2 æœåŠ¡é€‰æ‹©ç•Œé¢ä¼˜åŒ–
```javascript
// æ ¹æ®ä¸šåŠ¡ç±»å‹åŠ¨æ€åŠ è½½æœåŠ¡é€‰é¡¹
function loadServiceOptions(businessType) {
    fetch(`/api/services/available?businessType=${businessType}`)
    .then(response => response.json())
    .then(services => {
        displayServiceSelection(services);
    });
}

// æ˜¾ç¤ºæœåŠ¡é€‰æ‹©ç•Œé¢
function displayServiceSelection(services) {
    const container = document.getElementById('serviceSelection');
    container.innerHTML = services.map(service => `
        <div class="form-check">
            <input class="form-check-input" type="checkbox" 
                   value="${service.serviceCode}" id="service_${service.serviceCode}">
            <label class="form-check-label" for="service_${service.serviceCode}">
                ${service.serviceName} - ${service.description}
                <small class="text-muted">(${service.priceRange})</small>
            </label>
        </div>
    `).join('');
}
```

### 4.2 æœåŠ¡æ´¾å•åŠŸèƒ½

#### 4.2.1 æ´¾å•ç•Œé¢è®¾è®¡
```html
<!-- æœåŠ¡æ´¾å•ç•Œé¢ -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-tasks me-2"></i>æœåŠ¡æ´¾å• - è®¢å• ${orderId}</h5>
    </div>
    <div class="card-body">
        <div id="servicesToAssign">
            <!-- åŠ¨æ€åŠ è½½å¾…æ´¾å•æœåŠ¡ -->
        </div>
    </div>
</div>

<!-- å•ä¸ªæœåŠ¡æ´¾å•é¡¹ -->
<div class="service-assignment-item mb-3">
    <div class="row align-items-center">
        <div class="col-md-3">
            <strong>${serviceName}</strong>
            <small class="d-block text-muted">${serviceCode}</small>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="staff_${serviceId}" onchange="loadProtocolsForStaff(${serviceId})">
                <option value="">é€‰æ‹©æ“ä½œäººå‘˜...</option>
                <!-- åŠ¨æ€åŠ è½½æ“ä½œäººå‘˜ -->
            </select>
        </div>
        <div class="col-md-4">
            <select class="form-select" id="protocol_${serviceId}">
                <option value="">é€‰æ‹©å†…éƒ¨åè®®...</option>
                <!-- åŸºäºæ“ä½œäººå‘˜åŠ¨æ€åŠ è½½åè®® -->
            </select>
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary" onclick="assignService(${serviceId})">
                <i class="fas fa-paper-plane me-1"></i>æ´¾å•
            </button>
        </div>
    </div>
</div>
```

#### 4.2.2 åè®®åŒ¹é…é€»è¾‘
```java
@PostMapping("/services/{serviceId}/assign")
public ResponseEntity<AssignmentResponse> assignService(
    @PathVariable Long serviceId,
    @RequestBody ServiceAssignmentRequest request) {
    
    // 1. éªŒè¯å®¢æœæƒé™å’Œè®¢å•è´Ÿè´£å…³ç³»
    OrderService orderService = orderServiceRepository.findById(serviceId)
        .orElseThrow(() -> new EntityNotFoundException("æœåŠ¡ä¸å­˜åœ¨"));
    
    Order order = orderRepository.findById(orderService.getOrderId())
        .orElseThrow(() -> new EntityNotFoundException("è®¢å•ä¸å­˜åœ¨"));
    
    if (!order.getResponsibleStaffId().equals(request.getCustomerServiceId())) {
        throw new UnauthorizedException("åªæœ‰è®¢å•è´Ÿè´£äººæ‰èƒ½æ´¾å•");
    }
    
    // 2. éªŒè¯æ“ä½œäººå‘˜æƒé™
    Staff operationStaff = staffRepository.findById(request.getOperationStaffId())
        .orElseThrow(() -> new EntityNotFoundException("æ“ä½œäººå‘˜ä¸å­˜åœ¨"));
    
    if (!RoleType.OPERATION.equals(operationStaff.getRoleType())) {
        throw new InvalidRoleException("åªèƒ½æ´¾å•ç»™æ“ä½œäººå‘˜");
    }
    
    // 3. éªŒè¯åè®®æœ‰æ•ˆæ€§
    InternalProtocol protocol = internalProtocolRepository.findById(request.getProtocolId())
        .orElseThrow(() -> new EntityNotFoundException("å†…éƒ¨åè®®ä¸å­˜åœ¨"));
    
    if (!protocol.getActive() || !isProtocolApplicable(protocol, orderService, operationStaff)) {
        throw new InvalidProtocolException("åè®®ä¸é€‚ç”¨äºå½“å‰æœåŠ¡å’Œæ“ä½œäººå‘˜");
    }
    
    // 4. æ›´æ–°æœåŠ¡æ´¾å•ä¿¡æ¯
    orderService.setOperationStaffId(request.getOperationStaffId());
    orderService.setOperationDepartmentId(operationStaff.getDepartmentId());
    orderService.setInternalProtocolId(request.getProtocolId());
    orderService.setStatus(ServiceStatus.ASSIGNED);
    orderService.setAssignedTime(LocalDateTime.now());
    orderService.setAssignedBy(request.getCustomerServiceId());
    orderServiceRepository.save(orderService);
    
    // 5. åˆ›å»ºæ´¾å•é€šçŸ¥
    ServiceAssignmentNotification notification = new ServiceAssignmentNotification();
    notification.setOrderId(orderService.getOrderId());
    notification.setServiceId(serviceId);
    notification.setFromStaffId(request.getCustomerServiceId());
    notification.setToStaffId(request.getOperationStaffId());
    notification.setProtocolId(request.getProtocolId());
    notification.setMessage(request.getMessage());
    notification.setStatus(NotificationStatus.SENT);
    notification.setSentTime(LocalDateTime.now());
    notificationRepository.save(notification);
    
    // 6. å‘é€é€šçŸ¥ (å¯ä»¥æ˜¯é‚®ä»¶ã€çŸ­ä¿¡ã€ç«™å†…ä¿¡ç­‰)
    notificationService.sendAssignmentNotification(notification);
    
    return ResponseEntity.ok(new AssignmentResponse("æ´¾å•æˆåŠŸ", notification.getNotificationId()));
}
```

### 4.3 æ“ä½œäººå‘˜æ¥å•åŠŸèƒ½

#### 4.3.1 æˆ‘çš„ä»»åŠ¡ç•Œé¢
```html
<!-- æ“ä½œäººå‘˜ä»»åŠ¡åˆ—è¡¨ -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-inbox me-2"></i>æˆ‘çš„æ´¾å•ä»»åŠ¡</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>è®¢å•å·</th>
                        <th>æœåŠ¡ç±»å‹</th>
                        <th>æ´¾å•äºº</th>
                        <th>å†…éƒ¨åè®®</th>
                        <th>æ´¾å•æ—¶é—´</th>
                        <th>çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="myAssignmentTasks">
                    <!-- åŠ¨æ€åŠ è½½ -->
                </tbody>
            </table>
        </div>
    </div>
</div>
```

#### 4.3.2 åè®®ç¡®è®¤å¯¹è¯æ¡†
```html
<!-- åè®®ç¡®è®¤æ¨¡æ€æ¡† -->
<div class="modal fade" id="protocolConfirmModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-handshake me-2"></i>ç¡®è®¤å†…éƒ¨åè®®
                </h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">åè®®ä¿¡æ¯</h6>
                        <table class="table table-sm">
                            <tr><td>åè®®ç¼–å·:</td><td id="protocolId"></td></tr>
                            <tr><td>åè®®åç§°:</td><td id="protocolName"></td></tr>
                            <tr><td>é”€å”®éƒ¨é—¨:</td><td id="salesDept"></td></tr>
                            <tr><td>æ“ä½œéƒ¨é—¨:</td><td id="operationDept"></td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary">åˆ†æ¶¦è§„åˆ™</h6>
                        <table class="table table-sm">
                            <tr><td>åŸºæœ¬ä½£é‡‘ç‡:</td><td id="baseCommission"></td></tr>
                            <tr><td>ç»©æ•ˆå¥–é‡‘ç‡:</td><td id="performanceBonus"></td></tr>
                            <tr><td>ç”Ÿæ•ˆæ—¥æœŸ:</td><td id="effectiveDate"></td></tr>
                            <tr><td>è¿‡æœŸæ—¥æœŸ:</td><td id="expiryDate"></td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>ç¡®è®¤é¡»çŸ¥:</strong> ç‚¹å‡»ç¡®è®¤åï¼Œæ‚¨å°†æˆä¸ºæ­¤æœåŠ¡çš„è´Ÿè´£äººï¼Œå¹¶åŒæ„æŒ‰ç…§ä¸Šè¿°åè®®æ¡æ¬¾æ‰§è¡ŒæœåŠ¡å’Œè¿›è¡Œåˆ†æ¶¦ã€‚
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-success" onclick="confirmProtocolAndAcceptTask()">
                    <i class="fas fa-check me-2"></i>ç¡®è®¤åè®®å¹¶æ¥å•
                </button>
            </div>
        </div>
    </div>
</div>
```

#### 4.3.3 æ¥å•ç¡®è®¤é€»è¾‘
```java
@PostMapping("/services/{serviceId}/accept")
public ResponseEntity<AcceptanceResponse> acceptServiceTask(
    @PathVariable Long serviceId,
    @RequestBody TaskAcceptanceRequest request) {
    
    // 1. éªŒè¯æ“ä½œäººå‘˜æƒé™
    OrderService orderService = orderServiceRepository.findById(serviceId)
        .orElseThrow(() -> new EntityNotFoundException("æœåŠ¡ä»»åŠ¡ä¸å­˜åœ¨"));
    
    if (!orderService.getOperationStaffId().equals(request.getOperationStaffId())) {
        throw new UnauthorizedException("æ‚¨æ²¡æœ‰æƒé™æ¥å—æ­¤ä»»åŠ¡");
    }
    
    if (!ServiceStatus.ASSIGNED.equals(orderService.getStatus())) {
        throw new InvalidStatusException("ä»»åŠ¡çŠ¶æ€ä¸å…è®¸æ¥å•");
    }
    
    // 2. è®°å½•åè®®ç¡®è®¤
    orderService.setStatus(ServiceStatus.PROTOCOL_CONFIRMED);
    orderService.setProtocolConfirmedTime(LocalDateTime.now());
    orderService.setProtocolConfirmedBy(request.getOperationStaffId());
    orderService.setAcceptanceNotes(request.getNotes());
    orderServiceRepository.save(orderService);
    
    // 3. æ›´æ–°é€šçŸ¥çŠ¶æ€
    ServiceAssignmentNotification notification = notificationRepository
        .findByServiceIdAndToStaffId(serviceId, request.getOperationStaffId());
    if (notification != null) {
        notification.setStatus(NotificationStatus.CONFIRMED);
        notification.setConfirmedTime(LocalDateTime.now());
        notificationRepository.save(notification);
    }
    
    // 4. è§¦å‘åˆ†æ¶¦æ•°æ®å‡†å¤‡
    profitSharingService.prepareDataForService(orderService);
    
    // 5. å‘é€ç¡®è®¤é€šçŸ¥ç»™æ´¾å•å®¢æœ
    notificationService.sendAcceptanceConfirmation(orderService, request.getOperationStaffId());
    
    return ResponseEntity.ok(new AcceptanceResponse("æ¥å•æˆåŠŸ", orderService.getStatus()));
}
```

### 4.4 æƒé™ç®¡ç†å¢å¼º

#### 4.4.1 åŸºäºè§’è‰²çš„åŠŸèƒ½æ§åˆ¶
```java
@Component
public class PermissionValidator {
    
    // éªŒè¯è®¢å•åˆ›å»ºæƒé™
    public boolean canCreateOrder(String staffId) {
        Staff staff = staffRepository.findById(staffId).orElse(null);
        return staff != null && RoleType.CUSTOMER_SERVICE.equals(staff.getRoleType());
    }
    
    // éªŒè¯æ´¾å•æƒé™
    public boolean canAssignService(String orderId, String staffId) {
        Order order = orderRepository.findById(orderId).orElse(null);
        return order != null && staffId.equals(order.getResponsibleStaffId());
    }
    
    // éªŒè¯æ¥å•æƒé™
    public boolean canAcceptTask(Long serviceId, String staffId) {
        OrderService service = orderServiceRepository.findById(serviceId).orElse(null);
        return service != null && 
               staffId.equals(service.getOperationStaffId()) &&
               ServiceStatus.ASSIGNED.equals(service.getStatus());
    }
}
```

#### 4.4.2 å‰ç«¯æƒé™æ§åˆ¶
```javascript
// åŸºäºç”¨æˆ·è§’è‰²æ˜¾ç¤º/éšè—åŠŸèƒ½
function initializeUserInterface() {
    const userRole = getCurrentUserRole();
    
    if (userRole === 'CUSTOMER_SERVICE') {
        // å®¢æœç•Œé¢
        showElements([
            '#newOrderButton',
            '#serviceAssignmentSection',
            '#orderTrackingSection'
        ]);
        hideElements([
            '#myTasksSection'
        ]);
    } else if (userRole === 'OPERATION') {
        // æ“ä½œäººå‘˜ç•Œé¢
        showElements([
            '#myTasksSection',
            '#taskExecutionSection'
        ]);
        hideElements([
            '#newOrderButton',
            '#serviceAssignmentSection'
        ]);
    }
}
```

## 5. å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€: æ•°æ®æ¨¡å‹å’ŒåŸºç¡€åŠŸèƒ½ (1-2å¤©)
1. âœ… åˆ†æç°æœ‰ç³»ç»Ÿæ¶æ„
2. ğŸ”§ å¢å¼ºUserè§’è‰²å’ŒOrderServiceçŠ¶æ€
3. ğŸ”§ åˆ›å»ºServiceAssignmentNotificationå®ä½“
4. ğŸ”§ æ›´æ–°æ•°æ®åº“Schema

### é˜¶æ®µäºŒ: å®¢æœæ¥å•åŠŸèƒ½ (2-3å¤©)  
1. ğŸ”§ å¢å¼ºè®¢å•åˆ›å»ºæ¥å£
2. ğŸ”§ å®ç°æœåŠ¡é€‰æ‹©ç•Œé¢
3. ğŸ”§ å®Œå–„ä¸šåŠ¡ç±»å‹çº¦æŸé€»è¾‘
4. ğŸ”§ æµ‹è¯•å®¢æœæ¥å•æµç¨‹

### é˜¶æ®µä¸‰: æ´¾å•åŠŸèƒ½å¼€å‘ (3-4å¤©)
1. ğŸ”§ å®ç°åè®®åŒ¹é…ç®—æ³•
2. ğŸ”§ å¼€å‘æ´¾å•ç•Œé¢å’ŒAPI
3. ğŸ”§ åˆ›å»ºé€šçŸ¥å‘é€æœºåˆ¶
4. ğŸ”§ æµ‹è¯•å®Œæ•´æ´¾å•æµç¨‹

### é˜¶æ®µå››: æ¥å•ç¡®è®¤åŠŸèƒ½ (2-3å¤©)
1. ğŸ”§ å¼€å‘æ“ä½œäººå‘˜ä»»åŠ¡ç•Œé¢  
2. ğŸ”§ å®ç°åè®®ç¡®è®¤å¯¹è¯æ¡†
3. ğŸ”§ å®Œå–„æ¥å•ç¡®è®¤é€»è¾‘
4. ğŸ”§ é›†æˆåˆ†æ¶¦æ•°æ®å‡†å¤‡

### é˜¶æ®µäº”: é›†æˆæµ‹è¯•å’Œä¼˜åŒ– (2å¤©)
1. ğŸ”§ å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
2. ğŸ”§ æƒé™æ§åˆ¶éªŒè¯
3. ğŸ”§ æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†
4. ğŸ”§ ç”¨æˆ·ç•Œé¢ä¼˜åŒ–

## 6. æŠ€æœ¯è¦ç‚¹

### 6.1 çŠ¶æ€æœºè®¾è®¡
```
è®¢å•çŠ¶æ€æµè½¬:
DRAFT â†’ CONFIRMED â†’ IN_PROGRESS â†’ COMPLETED

æœåŠ¡çŠ¶æ€æµè½¬: 
PENDING â†’ ASSIGNED â†’ PROTOCOL_CONFIRMED â†’ IN_PROGRESS â†’ COMPLETED
```

### 6.2 äº‹åŠ¡ç®¡ç†
- è®¢å•åˆ›å»º+æœåŠ¡åˆ›å»º: å•ä¸€äº‹åŠ¡
- æœåŠ¡æ´¾å•+é€šçŸ¥å‘é€: åˆ†ç¦»äº‹åŠ¡(é€šçŸ¥å¤±è´¥ä¸å½±å“æ´¾å•)
- åè®®ç¡®è®¤+åˆ†æ¶¦å‡†å¤‡: å•ä¸€äº‹åŠ¡

### 6.3 å¼‚å¸¸å¤„ç†ç­–ç•¥
- æƒé™éªŒè¯: è¿”å›401/403çŠ¶æ€ç 
- æ•°æ®éªŒè¯: è¿”å›400çŠ¶æ€ç å¹¶æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯  
- ä¸šåŠ¡è§„åˆ™: è¿”å›409çŠ¶æ€ç å¹¶è¯´æ˜å†²çªåŸå› 
- ç³»ç»Ÿé”™è¯¯: è¿”å›500çŠ¶æ€ç å¹¶è®°å½•æ—¥å¿—

### 6.4 æ€§èƒ½ä¼˜åŒ–
- åè®®åŒ¹é…: å»ºç«‹å¤åˆç´¢å¼• (sales_dept + operation_dept + service_code)
- ä»»åŠ¡æŸ¥è¯¢: å»ºç«‹å¤åˆç´¢å¼• (operation_staff_id + status)
- é€šçŸ¥æŸ¥è¯¢: å»ºç«‹å¤åˆç´¢å¼• (to_staff_id + status + sent_time)

## 7. æµ‹è¯•æ–¹æ¡ˆ

### 7.1 å•å…ƒæµ‹è¯•
- åè®®åŒ¹é…ç®—æ³•æµ‹è¯•
- æƒé™éªŒè¯é€»è¾‘æµ‹è¯•  
- çŠ¶æ€è½¬æ¢è§„åˆ™æµ‹è¯•

### 7.2 é›†æˆæµ‹è¯•
- å®Œæ•´æ¥æ´¾å•æµç¨‹æµ‹è¯•
- å¤šç”¨æˆ·å¹¶å‘æ“ä½œæµ‹è¯•
- è·¨éƒ¨é—¨åä½œæµ‹è¯•

### 7.3 ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- å®¢æœæ“ä½œæµç¨‹æµ‹è¯•
- æ“ä½œäººå‘˜æ¥å•æµ‹è¯•
- ä¸»ç®¡ç›‘æ§åŠŸèƒ½æµ‹è¯•

è¿™ä¸ªå®æ–½æ–¹æ¡ˆåœ¨ç°æœ‰OneOrderç³»ç»ŸåŸºç¡€ä¸Šï¼Œå®Œæ•´å®ç°äº†æ‚¨éœ€è¦çš„æ¥æ´¾å•ä¸šåŠ¡æµç¨‹ï¼Œä¿æŒäº†æ•°æ®ä¸€è‡´æ€§å’Œä¸šåŠ¡é€»è¾‘çš„å®Œæ•´æ€§ã€‚