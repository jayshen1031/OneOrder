系统设计必须支撑的部分（清分规则与系统实现）

1. 核心抽象模型
	•	四类法人实体：客户法人、销售法人、交付法人、供应商法人
	•	订单/服务结构：
	•	一个订单可包含多个服务
	•	服务可下派至不同法人/部门
	•	多层派单模型：支持订单级联与容器模式

⸻

2. 清分规则引擎
	•	规则类型：
	•	标准模式：收入 – 成本 = 毛利
	•	借抬头模式：收款/付款借抬头，支持固定比例留存（如3%）
	•	过账模式：支持平收平付 / 抵消 / 区域差异玩法
	•	分润模式：五五开、比例、定额
	•	规则执行顺序：
	1.	判断是否借抬头（基于账号/法人号）
	2.	判断是否过账（按区域、币种、法人关系）
	3.	应用分润规则（五五开/比例/定额）
	4.	生成结果（管报 & 法报双轨）
	•	参数化配置：费率、分润比例、过账规则需可配置

⸻

3. 链式与新式资金流
	•	链式模式：严格按派单路径逐层清分，可能产生资金空转
	•	新式模式：以收款法人为总包，直接分配给销售、交付、付款法人，避免空转
	•	系统要求：
	•	支持两种模式切换
	•	默认推荐新式，链式作为兼容模式

⸻

4. 报表生成与双轨逻辑
	•	管理报表（管报）：外收、外支、内收、内支、毛利
	•	法定报表（法报）：法人对外收支、留存利润、税务口径
	•	双轨并存：
	•	先算管理账，再派生法人账
	•	遇到差异（如部门0利润 vs 法人五五开），需生成“差异标记”

⸻

5. 系统功能模块
	1.	清分逻辑引擎：统一规则引擎，支持链式/新式切换
	2.	借抬头处理模块：自动生成中间法人账
	3.	过账处理模块：支持插入过账法人、抵消规则、留存逻辑
	4.	报表模块：管报与法报双轨输出，含差异对照
	5.	配置后台：规则参数化管理（费率、分润、过账规则等）
	6.	可视化支撑：清分路径追踪、差异报表对照

⸻

6. 非功能性要求
	•	性能：日均上千单实时清分
	•	扩展性：支持未来税务模块、跨币种汇兑
	•	可追溯性：每笔清分结果可追溯到原始规则
	•	可维护性：规则引擎化，降低开发成本

⸻

✅ 总结一句话：
系统设计必须 抽象四类法人模型，实现 规则引擎驱动的自动清分，支持 链式/新式双模式，并能 同时输出管报与法报（带差异说明），核心模块包括 清分引擎、借抬头、过账、报表、配置后台、可视化。

