<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneOrder - Ë¥ß‰ª£ËÆ¢ÂçïÁÆ°ÁêÜÁ≥ªÁªü</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 0.75rem 1.25rem;
            margin: 0.2rem 0;
            border-radius: 0.375rem;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }
        .content-area {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.75rem rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
        }
        .service-card {
            transition: all 0.3s;
            cursor: pointer;
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15);
        }
        .service-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .ocean-freight { color: #0066cc; }
        .air-freight { color: #ff6600; }
        .truck-freight { color: #009900; }
        .rail-freight { color: #cc0066; }
        .customs { color: #9900cc; }
        .warehouse { color: #666666; }
        
        .price-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.8rem;
        }
        
        .order-status {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-confirmed { background-color: #d1ecf1; color: #0c5460; }
        .status-shipped { background-color: #d4edda; color: #155724; }
        .status-delivered { background-color: #d1ecf1; color: #0c5460; }
        .status-completed { background-color: #d4edda; color: #155724; }

        .fee-breakdown {
            background: linear-gradient(45deg, #f8f9fa, #ffffff);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .total-amount {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        
        /* Ê≥ï‰∫∫ÂÆû‰ΩìÊµÅËΩ¨ÂõæÊ†∑Âºè */
        .flow-diagram {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 2px solid #e9ecef;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .flow-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .flow-path {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .flow-path.vertical {
            flex-direction: column;
            align-items: center;
        }
        
        .flow-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #ffffff;
            border: 2px solid #dee2e6;
            border-radius: 0.75rem;
            padding: 0.75rem;
            min-width: 80px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .flow-node.highlight {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #ffffff 100%);
        }
        
        .flow-node.region {
            border-color: #17a2b8;
            background: linear-gradient(135deg, #d1ecf1 0%, #ffffff 100%);
        }
        
        .flow-node i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        .flow-node span {
            font-size: 0.8rem;
            font-weight: 500;
            text-align: center;
        }
        
        .retention-info {
            display: block;
            font-size: 0.7rem;
            color: #dc3545;
            font-weight: 600;
            margin-top: 0.25rem;
        }
        
        .flow-arrow {
            font-size: 1.5rem;
            color: #6c757d;
            font-weight: bold;
            margin: 0 0.5rem;
        }
        
        .flow-arrow-down {
            font-size: 1.5rem;
            color: #6c757d;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .netting-info {
            text-align: center;
            padding: 1rem;
            background: linear-gradient(135deg, #f8d7da 0%, #ffffff 100%);
            border: 1px solid #f5c6cb;
            border-radius: 0.5rem;
            color: #721c24;
            font-size: 0.9rem;
        }
        
        /* Ê∏ÖÂàÜÁªìÊûúË°®Ê†ºÊ†∑Âºè */
        .clearing-result-table {
            font-size: 0.9rem;
        }
        
        .clearing-result-table th {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
        }
        
        .clearing-result-table .amount-positive {
            color: #28a745;
            font-weight: 600;
        }
        
        .clearing-result-table .amount-negative {
            color: #dc3545;
            font-weight: 600;
        }
        
        .retention-highlight {
            background: linear-gradient(135deg, #fff3cd 0%, #ffffff 100%);
        }
        
        /* ËßÑÂàôÈÖçÁΩÆÂºÄÂÖ≥Ê†∑Âºè */
        .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        /* ËÆ¢ÂçïÂè∑ÊòæÁ§∫‰ºòÂåñ */
        .table .order-no-cell {
            word-break: break-all;
            min-width: 200px;
            max-width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .table .order-no-cell:hover {
            white-space: normal;
            overflow: visible;
            text-overflow: initial;
            background-color: #f8f9fa;
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- ‰æßËæπÂØºËà™ -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="text-center flex-grow-1">
                            <h4 class="text-white"><i class="fas fa-ship me-2"></i>OneOrder</h4>
                            <small class="text-white-50">Ë¥ß‰ª£ËÆ¢ÂçïÁÆ°ÁêÜÁ≥ªÁªü</small>
                        </div>
                        <!-- ÂÖ®Â±ÄÈÄöÁü•‰∏≠ÂøÉ -->
                        <div class="position-relative">
                            <button class="btn btn-outline-light btn-sm position-relative" onclick="notificationSystem.displayNotificationCenter()" title="ÈÄöÁü•‰∏≠ÂøÉ">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="globalNotificationCount" style="display: none;">0</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÁôªÂΩïÁî®Êà∑‰ø°ÊÅØ -->
                    <div class="user-info mb-4 p-3 bg-dark bg-opacity-25 rounded">
                        <div class="text-center">
                            <div class="user-avatar mb-2">
                                <i class="fas fa-user-circle text-white" style="font-size: 2rem;"></i>
                            </div>
                            <div class="user-details">
                                <div class="text-white fw-bold" id="currentUserName">Âº†ÁæéÂçé</div>
                                <small class="text-white-50" id="currentUserDept">ÂÆ¢Êúç‰∏≠ÂøÉ</small>
                                <div class="mt-1">
                                    <span class="badge bg-success" id="currentUserOpid">CS001</span>
                                    <span class="badge bg-warning text-dark ms-1">ÂÆ¢Êúç‰∏ìÂëò</span>
                                </div>
                                <div class="mt-1">
                                    <small class="text-info">
                                        <i class="fas fa-handshake me-1"></i>Êé•ÂçïÊùÉÈôêÔºöÂàõÂª∫ËÆ¢ÂçïÂπ∂Êàê‰∏∫Ë¥üË¥£‰∫∫
                                    </small>
                                </div>
                                <!-- ÂÖ®Â±ÄÁî®Êà∑ÂàáÊç¢‰∏ãÊãâËèúÂçï -->
                                <div class="mt-2">
                                    <select id="userSwitchSelect" class="form-select form-select-sm" style="font-size: 0.75rem;" data-role="user-selector">
                                        <!-- ÈÄâÈ°πÂ∞ÜÁî±GlobalUserManagerËá™Âä®ÁîüÊàê -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <ul class="nav flex-column">
                        <!-- Ê†∏ÂøÉ‰∏öÂä°ÊµÅÁ®ãÂØºËà™ -->
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard" onclick="showSection('dashboard')">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                ‰ª™Ë°®Áõò
                            </a>
                        </li>
                        
                        <!-- ÂÖ≠Â§ßÊ†∏ÂøÉÊ≠•È™§ -->
                        <li class="nav-item">
                            <a class="nav-link" href="#orders" onclick="showSection('orders')">
                                <i class="fas fa-clipboard-list me-2"></i>
                                1. ËÆ¢ÂçïÁÆ°ÁêÜ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#assignment" onclick="showSection('assignment')" data-page-permission="assignment">
                                <i class="fas fa-user-check me-2"></i>
                                2. Êé•Ê¥æÂçïÁÆ°ÁêÜ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="protocol-admin.html" target="_blank" data-page-permission="admin">
                                <i class="fas fa-handshake me-2"></i>
                                ÂçèËÆÆÈÖçÁΩÆÁÆ°ÁêÜ
                                <i class="fas fa-external-link-alt ms-1" style="font-size: 0.8em;"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#expense-entry" onclick="showSection('expense-entry')" data-page-permission="finance">
                                <i class="fas fa-file-invoice-dollar me-2"></i>
                                3. Ë¥πÁî®ÂΩïÂÖ•
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#profitsharing" onclick="showSection('profitsharing')" data-page-permission="reports">
                                <i class="fas fa-calculator me-2"></i>
                                4. ÂàÜÊ∂¶ËÆ°ÁÆó
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#clearing" onclick="showSection('clearing')" data-page-permission="clearing">
                                <i class="fas fa-cogs me-2"></i>
                                5. Ê∏ÖÂàÜÂ§ÑÁêÜ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#passthrough" onclick="showSection('passthrough')" data-page-permission="clearing">
                                <i class="fas fa-route me-2"></i>
                                5. ËøáË¥¶Â§ÑÁêÜ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#reports" onclick="showSection('reports')" data-page-permission="reports">
                                <i class="fas fa-chart-bar me-2"></i>
                                6. Ë¥¢Âä°Êä•Ë°®
                            </a>
                        </li>

                        <!-- ÂàÜÂâ≤Á∫ø -->
                        <li class="nav-item mt-3">
                            <hr style="border-color: rgba(255,255,255,0.3);">
                        </li>
                        
                        <!-- ËæÖÂä©ÂäüËÉΩ -->
                        <li class="nav-item">
                            <a class="nav-link" href="service-config.html" target="_blank">
                                <i class="fas fa-cog me-2"></i>
                                Á≥ªÁªüÈÖçÁΩÆ
                                <i class="fas fa-external-link-alt ms-1" style="font-size: 0.8rem;"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content-area">
                
                
                <!-- ‰ª™Ë°®Áõò -->
                <div id="dashboard" class="content-section">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tachometer-alt me-2"></i>Ë¥ß‰ª£‰∏öÂä°‰ª™Ë°®Áõò</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-primary" onclick="showSection('orders'); showNewOrderForm();">
                                <i class="fas fa-plus me-2"></i>Êñ∞Âª∫ËÆ¢Âçï
                            </button>
                        </div>
                    </div>
                    
                    <!-- ‰∏öÂä°ÁªüËÆ° -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="card text-center service-card ocean-freight">
                                <div class="card-body">
                                    <i class="fas fa-ship service-icon ocean-freight"></i>
                                    <h5>Êµ∑Ëøê‰∏öÂä°</h5>
                                    <h3 id="oceanOrders">0</h3>
                                    <p class="text-muted">Êú¨ÊúàËÆ¢Âçï</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="card text-center service-card air-freight">
                                <div class="card-body">
                                    <i class="fas fa-plane service-icon air-freight"></i>
                                    <h5>Á©∫Ëøê‰∏öÂä°</h5>
                                    <h3 id="airOrders">0</h3>
                                    <p class="text-muted">Êú¨ÊúàËÆ¢Âçï</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="card text-center service-card truck-freight">
                                <div class="card-body">
                                    <i class="fas fa-truck service-icon truck-freight"></i>
                                    <h5>ÈôÜËøê‰∏öÂä°</h5>
                                    <h3 id="truckOrders">0</h3>
                                    <p class="text-muted">Êú¨ÊúàËÆ¢Âçï</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="card text-center service-card rail-freight">
                                <div class="card-body">
                                    <i class="fas fa-train service-icon rail-freight"></i>
                                    <h5>ÈìÅËøê‰∏öÂä°</h5>
                                    <h3 id="railOrders">0</h3>
                                    <p class="text-muted">Êú¨ÊúàËÆ¢Âçï</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊúÄËøëËÆ¢Âçï -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-clock me-2"></i>ÊúÄËøëËÆ¢Âçï</h5>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadRecentOrders()">
                                <i class="fas fa-refresh me-1"></i>Âà∑Êñ∞
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 200px;">ËÆ¢ÂçïÂè∑</th>
                                            <th>ÂÆ¢Êà∑</th>
                                            <th>‰∏öÂä°Á±ªÂûã</th>
                                            <th>ÂåÖÂê´ÊúçÂä°</th>
                                            <th>Ëµ∑ÂßãÂú∞</th>
                                            <th>ÁõÆÁöÑÂú∞</th>
                                            <th>ÈáëÈ¢ù</th>
                                            <th>Áä∂ÊÄÅ</th>
                                            <th>ÂÆ¢ÊúçË¥üË¥£‰∫∫</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentOrdersTable">
                                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ËÆ¢ÂçïÁÆ°ÁêÜ -->
                <div id="orders" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-clipboard-list me-2"></i>ËÆ¢ÂçïÁÆ°ÁêÜ</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-primary" onclick="showNewOrderForm()">
                                <i class="fas fa-plus me-2"></i>Êñ∞Âª∫ËÆ¢Âçï
                            </button>
                        </div>
                    </div>
                    
                    <!-- ËßíËâ≤ÊèêÁ§∫Âå∫Âüü -->
                    <div id="roleNoticeArea" class="mb-3"></div>
                    
                    <!-- Êñ∞Âª∫ËÆ¢ÂçïË°®Âçï -->
                    <div class="card mb-4" id="newOrderForm" style="display:none;">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-plus me-2"></i>Êñ∞Âª∫Ë¥ß‰ª£ËÆ¢Âçï</h5>
                        </div>
                        <div class="card-body">
                            <form id="orderForm">
                                <!-- ÂÆ¢Êúç‰ø°ÊÅØ -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h6 class="text-primary"><i class="fas fa-user-tie me-2"></i>ÂÆ¢Êúç‰ø°ÊÅØ</h6>
                                        <hr>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ÂΩìÂâçÁôªÂΩïÂÆ¢Êúç</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            <input type="text" class="form-control" id="currentOperator" readonly>
                                        </div>
                                        <small class="text-muted">ÂΩìÂâçÁôªÂΩïÁî®Êà∑Â∞ÜÊàê‰∏∫ËÆ¢ÂçïË¥üË¥£‰∫∫</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Êé•ÂçïÊó∂Èó¥</label>
                                        <input type="datetime-local" class="form-control" id="receiveTime" readonly>
                                    </div>
                                </div>

                                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h6 class="text-primary"><i class="fas fa-info-circle me-2"></i>Âü∫Êú¨‰ø°ÊÅØ</h6>
                                        <hr>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ËÆ¢ÂçïÂè∑</label>
                                        <input type="text" class="form-control" id="orderNo" readonly>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ÂÆ¢Êà∑ÂêçÁß∞ *</label>
                                        <select class="form-select" id="customerId" required onchange="updateCustomerInfo()">
                                            <option value="">ËØ∑ÈÄâÊã©ÂÆ¢Êà∑</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">‰∏öÂä°Á±ªÂûã *</label>
                                        <select class="form-select" id="businessType" required onchange="loadServiceOptions()">
                                            <option value="">ËØ∑ÈÄâÊã©‰∏öÂä°Á±ªÂûã</option>
                                            <option value="OCEAN">Êµ∑Ëøê</option>
                                            <option value="AIR">Á©∫Ëøê</option>
                                            <option value="TRUCK">ÈôÜËøê</option>
                                            <option value="RAIL">ÈìÅËøê</option>
                                            <option value="MULTIMODAL">Â§öÂºèËÅîËøê</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- ËøêËæì‰ø°ÊÅØ -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h6 class="text-primary"><i class="fas fa-route me-2"></i>ËøêËæì‰ø°ÊÅØ</h6>
                                        <hr>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Ëµ∑ËøêÊ∏Ø/Âú∞ *</label>
                                        <input type="text" class="form-control" id="portOfLoading" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">ÁõÆÁöÑÊ∏Ø/Âú∞ *</label>
                                        <input type="text" class="form-control" id="portOfDischarge" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">È¢ÑËÆ°ÂºÄËàπ/Ëµ∑ËøêÊó•Êúü</label>
                                        <input type="date" class="form-control" id="estimatedDeparture">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">È¢ÑËÆ°Âà∞ËææÊó•Êúü</label>
                                        <input type="date" class="form-control" id="estimatedArrival">
                                    </div>
                                </div>
                                
                                <!-- Ë¥ßÁâ©‰ø°ÊÅØ -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h6 class="text-primary"><i class="fas fa-boxes me-2"></i>Ë¥ßÁâ©‰ø°ÊÅØ</h6>
                                        <hr>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Ë¥ßÁâ©ÊèèËø∞</label>
                                        <input type="text" class="form-control" id="cargoDescription">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">‰ª∂Êï∞</label>
                                        <input type="number" class="form-control" id="packageCount">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">ÈáçÈáè (KG)</label>
                                        <input type="number" class="form-control" id="weight" step="0.1">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">‰ΩìÁßØ (CBM)</label>
                                        <input type="number" class="form-control" id="volume" step="0.001">
                                    </div>
                                </div>
                                
                                <!-- ÊúçÂä°ÈÄâÊã© -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h6 class="text-primary"><i class="fas fa-tools me-2"></i>ÊúçÂä°ÈÄâÊã©</h6>
                                        <hr>
                                    </div>
                                    <!-- ÊúçÂä°ÈÄâÊã©Ê±áÊÄª -->
                                    <div class="col-12 mb-3">
                                        <div class="alert alert-info d-none" id="selectedServicesAlert">
                                            <h6 class="alert-heading"><i class="fas fa-list me-2"></i>Â∑≤ÈÄâÊã©ÁöÑÊúçÂä°È°πÁõÆÔºö</h6>
                                            <div id="selectedServicesList">
                                                <!-- Âä®ÊÄÅÊòæÁ§∫Â∑≤ÈÄâÊã©ÁöÑÊúçÂä° -->
                                            </div>
                                            <div class="mt-2">
                                                <small class="text-muted">ÂÖ±ÈÄâÊã© <span id="selectedServicesCount">0</span> È°πÊúçÂä°</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="serviceSelection">
                                        <!-- Âä®ÊÄÅÂä†ËΩΩÊúçÂä°ÈÄâÈ°π -->
                                    </div>
                                </div>
                                
                                <!-- Ë¥πÁî®ÊòéÁªÜ -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <h6 class="text-primary"><i class="fas fa-calculator me-2"></i>Ë¥πÁî®ÊòéÁªÜ</h6>
                                        <hr>
                                    </div>
                                    <div class="col-12">
                                        <div id="feeBreakdown">
                                            <!-- Âä®ÊÄÅÁîüÊàêË¥πÁî®ÊòéÁªÜ -->
                                        </div>
                                        <div class="total-amount mt-3">
                                            <h5>ÊÄªÈáëÈ¢ù: <span id="totalAmount">¬• 0.00</span></h5>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Êìç‰ΩúÊåâÈíÆ -->
                                <div class="row">
                                    <div class="col-12">
                                        <div class="btn-group me-2">
                                            <button type="button" class="btn btn-outline-primary" onclick="calculateFees()">
                                                <i class="fas fa-calculator me-2"></i>ËÆ°ÁÆóË¥πÁî®
                                            </button>
                                            <button type="button" class="btn btn-primary" onclick="saveOrder()" data-feature-permission="create_order">
                                                <i class="fas fa-save me-2"></i>‰øùÂ≠òËÆ¢Âçï
                                            </button>
                                            <button type="button" class="btn btn-success" onclick="submitOrder()" data-feature-permission="create_order">
                                                <i class="fas fa-paper-plane me-2"></i>ÂÆ¢ÊúçÊé•Âçï
                                            </button>
                                        </div>
                                        <button type="button" class="btn btn-secondary" onclick="cancelNewOrder()">
                                            <i class="fas fa-times me-2"></i>ÂèñÊ∂à
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- ËÆ¢ÂçïÂàóË°® -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-list me-2"></i>ËÆ¢ÂçïÂàóË°®</h5>
                            <div class="d-flex gap-2">
                                <select class="form-select form-select-sm" id="orderStatusFilter" onchange="filterOrders()">
                                    <option value="">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                                    <option value="PENDING">ÂæÖÁ°ÆËÆ§</option>
                                    <option value="CONFIRMED">Â∑≤Á°ÆËÆ§</option>
                                    <option value="SHIPPED">Â∑≤ÂèëËøê</option>
                                    <option value="DELIVERED">Â∑≤ÈÄÅËææ</option>
                                    <option value="COMPLETED">Â∑≤ÂÆåÊàê</option>
                                </select>
                                <button class="btn btn-sm btn-outline-primary" onclick="loadOrders()">
                                    <i class="fas fa-refresh me-1"></i>Âà∑Êñ∞
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 200px;">ËÆ¢ÂçïÂè∑</th>
                                            <th>ÂÆ¢Êà∑</th>
                                            <th>‰∏öÂä°Á±ªÂûã</th>
                                            <th>ÂåÖÂê´ÊúçÂä°</th>
                                            <th>Ëµ∑ÂßãÂú∞</th>
                                            <th>ÁõÆÁöÑÂú∞</th>
                                            <th>ÈáëÈ¢ù</th>
                                            <th>Áä∂ÊÄÅ</th>
                                            <th>ÂÆ¢ÊúçË¥üË¥£‰∫∫</th>
                                            <th>ÂàõÂª∫Êó∂Èó¥</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersTable">
                                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <!-- ‰ªªÂä°ÁÆ°ÁêÜ -->
                <div id="tasks" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tasks me-2"></i>‰ªªÂä°ÁÆ°ÁêÜ</h1>
                        <div>
                            <button class="btn btn-outline-primary me-2" onclick="loadMyTasks()">
                                <i class="fas fa-sync me-1"></i>Âà∑Êñ∞‰ªªÂä°
                            </button>
                            <button class="btn btn-primary" onclick="showServiceAssignModal()">
                                <i class="fas fa-plus me-1"></i>Êñ∞Â¢ûÊ¥æÂçï
                            </button>
                        </div>
                    </div>
                    
                    <!-- Êìç‰Ωú‰∫∫ÂëòÈÄâÊã© -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-user-cog me-2"></i>Êìç‰Ωú‰∫∫ÂëòÈÄâÊã©</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label">ÈÄâÊã©Êìç‰Ωú‰∫∫Âëò</label>
                                    <select class="form-select" id="selectedOperationStaff">
                                        <option value="">ËØ∑ÈÄâÊã©Êìç‰Ωú‰∫∫Âëò...</option>
                                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                                    </select>
                                </div>
                                <div class="col-md-8 d-flex align-items-end">
                                    <button type="button" class="btn btn-info" onclick="loadOperationStaff()">
                                        <i class="fas fa-users me-1"></i>Âä†ËΩΩÊìç‰Ωú‰∫∫Âëò
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊàëÁöÑ‰ªªÂä°ÂàóË°® -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-clipboard-check me-2"></i>ÊàëÁöÑ‰ªªÂä°</h5>
                            <div class="d-flex gap-2">
                                <select class="form-select form-select-sm" id="taskStatusFilter" onchange="filterTasks()">
                                    <option value="">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                                    <option value="ASSIGNED">Â∑≤Ê¥æÂçï</option>
                                    <option value="PROTOCOL_CONFIRMED">ÂçèËÆÆÂ∑≤Á°ÆËÆ§</option>
                                    <option value="IN_PROGRESS">ÊâßË°å‰∏≠</option>
                                    <option value="COMPLETED">Â∑≤ÂÆåÊàê</option>
                                    <option value="BLOCKED">ÂèóÈòª</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ËÆ¢ÂçïÂè∑</th>
                                            <th>ÊúçÂä°Á±ªÂûã</th>
                                            <th>ÂÜÖÈÉ®ÂçèËÆÆ</th>
                                            <th>Áä∂ÊÄÅ</th>
                                            <th>Ê¥æÂçïÊó∂Èó¥</th>
                                            <th>ÂçèËÆÆÁ°ÆËÆ§Êó∂Èó¥</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="myTasksTable">
                                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Êé•Ê¥æÂçïÁÆ°ÁêÜ -->
                <div id="assignment" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-user-check me-2"></i>Êé•Ê¥æÂçïÁÆ°ÁêÜ</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-outline-primary" onclick="window.open('protocol-admin.html', '_blank')">
                                    <i class="fas fa-handshake me-2"></i>ÂçèËÆÆÈÖçÁΩÆ
                                </button>
                            </div>
                            <button type="button" class="btn btn-outline-secondary" onclick="showSection('orders')">
                                <i class="fas fa-arrow-left me-2"></i>ËøîÂõûËÆ¢ÂçïÁÆ°ÁêÜ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÂÆåÊï¥ÁöÑÊé•Ê¥æÂçïÂäüËÉΩ -->
                    <div class="row">
                        <!-- Â∑¶‰æßÔºöËÆ¢ÂçïÈÄâÊã©ÂíåÊúçÂä°ÂàóË°® -->
                        <div class="col-lg-8">
                            <!-- ËÆ¢ÂçïÈÄâÊã© -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5><i class="fas fa-search me-2"></i>ÈÄâÊã©ËÆ¢Âçï</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">ÈÄâÊã©ËÆ¢Âçï</label>
                                        <div class="input-group">
                                            <select class="form-select" id="orderSelect" onchange="loadOrderServices()">
                                                <option value="">ËØ∑ÈÄâÊã©ËÆ¢Âçï</option>
                                            </select>
                                            <button class="btn btn-outline-secondary" type="button" onclick="loadOrderList()" title="Âà∑Êñ∞ËÆ¢ÂçïÂàóË°®">
                                                <i class="fas fa-refresh"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÊúçÂä°È°πÁõÆÂàóË°® -->
                            <div class="card mb-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-cog me-2"></i>ÊúçÂä°È°πÁõÆ</h5>
                                    <div>
                                        <button class="btn btn-primary btn-sm" onclick="autoAssignAll()">
                                            <i class="fas fa-magic"></i> Êô∫ËÉΩÊ¥æÂçï
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="batchAssign()">
                                            <i class="fas fa-tasks"></i> ÊâπÈáèÊ¥æÂçï
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="servicesContainer">
                                        <div class="text-center py-5">
                                            <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">ËØ∑ÂÖàÈÄâÊã©ËÆ¢Âçï‰ª•Âä†ËΩΩÊúçÂä°È°πÁõÆ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Âè≥‰æßÔºöÊìç‰Ωú‰∫∫ÂëòÂíåÂéÜÂè≤ËÆ∞ÂΩï -->
                        <div class="col-lg-4">
                            <!-- ÂèØÁî®Êìç‰Ωú‰∫∫Âëò -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6><i class="fas fa-users me-2"></i>ÂèØÁî®Êìç‰Ωú‰∫∫Âëò</h6>
                                </div>
                                <div class="card-body">
                                    <div id="operatorsContainer">
                                        <div class="text-center py-3">
                                            <i class="fas fa-user-clock fa-2x text-muted mb-2"></i>
                                            <p class="text-muted">Âä†ËΩΩ‰∏≠...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ê¥æÂçïÂéÜÂè≤ -->
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-history me-2"></i>Ê¥æÂçïÂéÜÂè≤</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                        <table class="table table-sm">
                                            <tbody id="assignmentHistoryTableBody">
                                                <tr>
                                                    <td class="text-center py-4">
                                                        <i class="fas fa-history fa-2x text-muted mb-2 d-block"></i>
                                                        <p class="text-muted">ÊöÇÊó†Ê¥æÂçïÂéÜÂè≤ËÆ∞ÂΩï</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Êìç‰ΩúÂëòÂ∑•‰ΩúÂè∞ -->
                <div id="operator-workbench" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-briefcase me-2"></i>ÊàëÁöÑÂ∑•‰ΩúÂè∞</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-outline-primary" onclick="refreshMyTasks()">
                                    <i class="fas fa-sync-alt me-2"></i>Âà∑Êñ∞‰ªªÂä°
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ê¨¢ËøéÊ∂àÊÅØ -->
                    <div class="alert alert-info border-info mb-4" style="border-left: 5px solid #17a2b8;">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-circle fa-2x text-info me-3"></i>
                            <div>
                                <h6 class="alert-heading mb-1">üëã Ê¨¢ËøéÂõûÊù•ÔºÅ</h6>
                                <p class="mb-0">
                                    <span id="operatorWelcomeName">Êìç‰ΩúÂëò</span>ÔºåÊÇ®Êúâ <span id="pendingTaskCount" class="fw-bold text-primary">0</span> ‰∏™ÂæÖÂ§ÑÁêÜ‰ªªÂä°
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊàëÁöÑ‰ªªÂä°ÂàóË°® -->
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-clipboard-list me-2"></i>ÊàëÁöÑÂæÖÂäû‰ªªÂä°
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <div id="myTasksList">
                                        <div class="text-center py-5">
                                            <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">Ê≠£Âú®Âä†ËΩΩÊÇ®ÁöÑ‰ªªÂä°...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <!-- ‰ªªÂä°ÁªüËÆ° -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-chart-pie me-2"></i>‰ªªÂä°ÁªüËÆ°
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-6">
                                            <div class="border-end">
                                                <h4 class="text-warning mb-1" id="pendingTasksCount">0</h4>
                                                <small class="text-muted">ÂæÖÂ§ÑÁêÜ</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <h4 class="text-success mb-1" id="completedTasksCount">0</h4>
                                            <small class="text-muted">Â∑≤ÂÆåÊàê</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Âø´ÈÄüÊìç‰Ωú -->
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-bolt me-2"></i>Âø´ÈÄüÊìç‰Ωú
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="showSection('expense-entry')">
                                            <i class="fas fa-file-invoice-dollar me-2"></i>ÂΩïÂÖ•Ë¥πÁî®
                                        </button>
                                        <button type="button" class="btn btn-outline-info btn-sm" onclick="viewTaskHistory()">
                                            <i class="fas fa-history me-2"></i>‰ªªÂä°ÂéÜÂè≤
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" onclick="markAllTasksRead()">
                                            <i class="fas fa-check-double me-2"></i>Ê†áËÆ∞Â∑≤ËØª
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ë¥πÁî®ÂΩïÂÖ• -->
                <div id="expense-entry" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-file-invoice-dollar me-2"></i>Ë¥πÁî®ÂΩïÂÖ•</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-outline-secondary" onclick="showSection('assignment')">
                                    <i class="fas fa-arrow-left me-2"></i>ËøîÂõûÊé•Ê¥æÂçï
                                </button>
                                <button type="button" class="btn btn-primary" onclick="proceedToProfit()">
                                    <i class="fas fa-arrow-right me-2"></i>ËøõÂÖ•ÂàÜÊ∂¶ËÆ°ÁÆó
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊµÅÁ®ãÊèêÁ§∫ -->
                    <div class="alert alert-info">
                        <h5 class="alert-heading">
                            <i class="fas fa-route me-2"></i>‰∏öÂä°ÊµÅÁ®ãÊèêÁ§∫
                        </h5>
                        <p class="mb-2">
                            <strong>ÂΩìÂâçÁéØËäÇÔºöË¥πÁî®ÂΩïÂÖ•</strong> - Âú®Ê¥æÂçïÂÆåÊàêÂêéÔºåÈúÄË¶ÅÂΩïÂÖ•ËÆ¢ÂçïÁöÑÊî∂Ë¥πÂíå‰ªòË¥πÊòéÁªÜ
                        </p>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>üìù ÈúÄË¶ÅÂΩïÂÖ•ÁöÑË¥πÁî®Ôºö</strong>
                                <ul class="mb-0">
                                    <li>Â§ñÈÉ®Êî∂Ê¨æÊòéÁªÜÔºàÂêëÂÆ¢Êà∑Êî∂ÂèñÁöÑË¥πÁî®Ôºâ</li>
                                    <li>Â§ñÈÉ®‰ªòÊ¨æÊòéÁªÜÔºàÂêë‰æõÂ∫îÂïÜÊîØ‰ªòÁöÑË¥πÁî®Ôºâ</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <strong>‚ö° ÂÄüÊä¨Â§¥ÂäüËÉΩÂ¢ûÂº∫Ôºö</strong>
                                <ul class="mb-0">
                                    <li>Ëá™Âä®ËØÜÂà´ÈªòËÆ§Ê≥ï‰∫∫‰∏éÂÆûÈôÖÊ≥ï‰∫∫Â∑ÆÂºÇ</li>
                                    <li>Êô∫ËÉΩÊ†áËÆ∞ÂÄüÊä¨Â§¥Á±ªÂûãÔºàÊî∂Ê¨æ/‰ªòÊ¨æÔºâ</li>
                                    <li>Â§ßÈ¢ùÂÄüÊä¨Â§¥Ëá™Âä®ÈúÄË¶ÅÂÆ°ÊâπÔºà‚â•5‰∏áÂÖÉÔºâ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ë¥πÁî®ÂΩïÂÖ•ÁïåÈù¢ÈõÜÊàê -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-plus-circle me-2"></i>Ë¥πÁî®ÊòéÁªÜÂΩïÂÖ•
                                <span class="badge bg-success ms-2">Â∑≤Â¢ûÂº∫ÂÄüÊä¨Â§¥ÂäüËÉΩ</span>
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <iframe id="expenseEntryFrame" 
                                    src="expense-entry-management.html?v=20250921-2330" 
                                    frameborder="0" 
                                    style="width: 100%; height: 800px; border: none;">
                                <p>ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅiframeÔºåËØ∑<a href="expense-entry-management.html" target="_blank">ÁÇπÂáªËøôÈáå</a>ËÆøÈóÆË¥πÁî®ÂΩïÂÖ•È°µÈù¢„ÄÇ</p>
                            </iframe>
                        </div>
                    </div>
                    
                    <!-- Ë¥πÁî®ÂΩïÂÖ•Áä∂ÊÄÅÁõëÊéß -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-list-check me-2"></i>Ë¥πÁî®ÂΩïÂÖ•ËøõÂ∫¶</h6>
                                </div>
                                <div class="card-body">
                                    <div id="expenseEntryProgress">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="fas fa-circle-notch fa-spin text-primary me-2"></i>
                                            <span>Ê≠£Âú®Âä†ËΩΩË¥πÁî®ÂΩïÂÖ•Áä∂ÊÄÅ...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-exclamation-triangle me-2"></i>ÂÄüÊä¨Â§¥ÊèêÈÜí</h6>
                                </div>
                                <div class="card-body">
                                    <div id="transitEntityReminder">
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-info-circle me-2"></i>
                                            Á≥ªÁªüÂ∑≤Ëá™Âä®Â¢ûÂº∫ÂÄüÊä¨Â§¥ËÆ∞ÂΩïÂäüËÉΩ
                                        </p>
                                        <ul class="list-unstyled small">
                                            <li>‚úÖ Ëá™Âä®ËÆ∞ÂΩïÈªòËÆ§Ê≥ï‰∫∫‰∏éÂÆûÈôÖÊ≥ï‰∫∫Â∑ÆÂºÇ</li>
                                            <li>‚úÖ Êô∫ËÉΩÂà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂÄüÊä¨Â§¥ÂÆ°Êâπ</li>
                                            <li>‚úÖ ÂÆåÊï¥‰øùÁïôÂÄüÊä¨Â§¥ÈÄâÊã©ÁöÑ‰∏öÂä°ÂéüÂõ†</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÂàÜÊ∂¶ËÆ°ÁÆó -->
                <div id="profitsharing" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-calculator me-2"></i>ÂàÜÊ∂¶ËÆ°ÁÆó</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-outline-secondary" onclick="showSection('expense-entry')">
                                <i class="fas fa-arrow-left me-2"></i>ËøîÂõûË¥πÁî®ÂΩïÂÖ•
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body p-0">
                            <iframe id="profitsharingFrame" 
                                    src="profit-sharing.html" 
                                    frameborder="0" 
                                    style="width: 100%; height: 800px; border: none;">
                                <p>ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅiframeÔºåËØ∑<a href="profit-sharing.html" target="_blank">ÁÇπÂáªËøôÈáå</a>ËÆøÈóÆÂàÜÊ∂¶ËÆ°ÁÆóÈ°µÈù¢„ÄÇ</p>
                            </iframe>
                        </div>
                    </div>
                </div>
                
                <!-- Ê∏ÖÂàÜÂ§ÑÁêÜ -->
                <div id="clearing" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-cogs me-2"></i>Ê∏ÖÂàÜÂ§ÑÁêÜ</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-outline-secondary" onclick="showSection('profitsharing')">
                                <i class="fas fa-arrow-left me-2"></i>ËøîÂõûÂàÜÊ∂¶ËÆ°ÁÆó
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body p-0">
                            <iframe id="clearingFrame" 
                                    src="index.html" 
                                    frameborder="0" 
                                    style="width: 100%; height: 800px; border: none;">
                                <p>ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅiframeÔºåËØ∑<a href="index.html" target="_blank">ÁÇπÂáªËøôÈáå</a>ËÆøÈóÆÊ∏ÖÂàÜÂ§ÑÁêÜÈ°µÈù¢„ÄÇ</p>
                            </iframe>
                        </div>
                    </div>
                </div>
                
                <!-- ËøáË¥¶Â§ÑÁêÜ -->
                <div id="passthrough" class="content-section" style="display:none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-route me-2"></i>ËøáË¥¶Â§ÑÁêÜ</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-outline-secondary" onclick="showSection('clearing')">
                                <i class="fas fa-arrow-left me-2"></i>ËøîÂõûÊ∏ÖÂàÜÂ§ÑÁêÜ
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body text-center p-5">
                            <i class="fas fa-route fa-3x text-muted mb-3"></i>
                            <h4 class="text-muted">ËøáË¥¶Â§ÑÁêÜÊ®°Âùó</h4>
                            <p class="text-muted">ËøáË¥¶Â§ÑÁêÜÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÂ∞ÜÊîØÊåÅËµÑÈáëË∑ØÁî±„ÄÅËΩßÂ∑ÆÁªìÁÆóÁ≠âÂäüËÉΩ</p>
                            <div class="mt-4">
                                <span class="badge bg-secondary me-2">ÂºÄÂèë‰∏≠</span>
                                <span class="badge bg-info">È¢ÑËÆ°‰∏ã‰∏™ÁâàÊú¨‰∏äÁ∫ø</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ë¥¢Âä°Êä•Ë°®ÈÉ®ÂàÜ -->
                <div id="reports" class="content-section" style="display:none;">
                    <h1 class="h2">Ë¥¢Âä°Êä•Ë°®‰∏≠ÂøÉ</h1>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card service-card" onclick="navigateToEntityReports()">
                                <div class="card-body text-center">
                                    <div class="service-icon">
                                        <i class="fas fa-building" style="color: #667eea;"></i>
                                    </div>
                                    <h5 class="card-title">ÁÆ°Ê≥ïÂàÜÁ¶ªÊä•Ë°®</h5>
                                    <p class="card-text">ÁÆ°ÁêÜÂÆû‰Ωì‰∏éÊ≥ï‰∫∫ÂÆû‰ΩìÂàÜÁ¶ªÁöÑË¥¢Âä°Êä•Ë°®ÂàÜÊûêÔºåÂåÖÂê´ËµÑÈáëÊµÅÂêë„ÄÅÊçüÁõäÂàÜÊûê„ÄÅËøáË¥¶ÁªüËÆ°„ÄÅÂêàËßÑÊ£ÄÊü•Á≠âÂäüËÉΩ</p>
                                    <div class="mt-3">
                                        <span class="badge bg-primary me-2">ÂÆû‰ΩìÁÆ°ÁêÜ</span>
                                        <span class="badge bg-success me-2">ËµÑÈáëÊµÅÂêë</span>
                                        <span class="badge bg-info">ÂêàËßÑÊ£ÄÊü•</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card service-card" style="opacity: 0.6;">
                                <div class="card-body text-center">
                                    <div class="service-icon">
                                        <i class="fas fa-chart-line text-muted"></i>
                                    </div>
                                    <h5 class="card-title text-muted">‰∏öÂä°ÂàÜÊûêÊä•Ë°®</h5>
                                    <p class="card-text text-muted">‰∏öÂä°Êï∞ÊçÆÁªüËÆ°ÂàÜÊûê„ÄÅË∂ãÂäøÈ¢ÑÊµã„ÄÅKPI‰ª™Ë°®ÁõòÁ≠âÂäüËÉΩ</p>
                                    <span class="badge bg-secondary">ÂºÄÂèë‰∏≠</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card service-card" style="opacity: 0.6;">
                                <div class="card-body text-center">
                                    <div class="service-icon">
                                        <i class="fas fa-file-invoice-dollar text-muted"></i>
                                    </div>
                                    <h5 class="card-title text-muted">Á®éÂä°Áî≥Êä•Êä•Ë°®</h5>
                                    <p class="card-text text-muted">Á®éÂä°ÂêàËßÑÁî≥Êä•„ÄÅÂ¢ûÂÄºÁ®éÂ§ÑÁêÜ„ÄÅÊâÄÂæóÁ®éËÆ°ÁÆóÁ≠âÂäüËÉΩ</p>
                                    <span class="badge bg-secondary">ËßÑÂàí‰∏≠</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÁÆ°Ê≥ïÂàÜÁ¶ªÊä•Ë°®Âø´ÈÄüÂÖ•Âè£ -->
                    <div class="card mt-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>ÁÆ°Ê≥ïÂàÜÁ¶ªÊä•Ë°®Âø´ÈÄüÂÖ•Âè£</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="d-grid">
                                        <button class="btn btn-outline-primary" onclick="navigateToEntityReports('entities')">
                                            <i class="fas fa-sitemap me-2"></i>ÂÆû‰ΩìÁÆ°ÁêÜ
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-grid">
                                        <button class="btn btn-outline-success" onclick="navigateToEntityReports('fund-flow')">
                                            <i class="fas fa-exchange-alt me-2"></i>ËµÑÈáëÊµÅÂêë
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-grid">
                                        <button class="btn btn-outline-info" onclick="navigateToEntityReports('profit-loss')">
                                            <i class="fas fa-chart-line me-2"></i>ÊçüÁõäÂàÜÊûê
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="d-grid">
                                        <button class="btn btn-outline-warning" onclick="navigateToEntityReports('compliance')">
                                            <i class="fas fa-shield-alt me-2"></i>ÂêàËßÑÊ£ÄÊü•
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="customers" class="content-section" style="display:none;">
                    <h1 class="h2">ÂÆ¢Êà∑ÁÆ°ÁêÜ</h1>
                    <p>ÂÆ¢Êà∑ÁÆ°ÁêÜÂäüËÉΩÂºÄÂèë‰∏≠...</p>
                </div>
                
            </main>
        </div>
    </div>
    
    <!-- ÊúçÂä°Ê¥æÂçïÁïåÈù¢ -->
    <div id="serviceAssignmentSection" class="content-section" style="display:none;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2"><i class="fas fa-tasks me-2"></i>ÊúçÂä°Ê¥æÂçï</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <button type="button" class="btn btn-outline-secondary" onclick="showSection('orders')">
                    <i class="fas fa-arrow-left me-2"></i>ËøîÂõûËÆ¢ÂçïÂàóË°®
                </button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>ÂæÖÊ¥æÂçïÊúçÂä°ÂàóË°®</h5>
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="loadAllAvailableStaff()">
                        <i class="fas fa-users me-1"></i>Âä†ËΩΩÊìç‰Ωú‰∫∫Âëò
                    </button>
                    <button type="button" class="btn btn-success btn-sm" onclick="batchAssignServices()">
                        <i class="fas fa-tasks me-1"></i>ÊâπÈáèÊ¥æÂçï
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="pendingServicesList">
                    <!-- Âä®ÊÄÅÂä†ËΩΩÂæÖÊ¥æÂçïÊúçÂä° -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ËÆ¢ÂçïÂàõÂª∫ÁªìÊûúÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="orderCreationResultModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle me-2"></i>ËÆ¢ÂçïÂàõÂª∫ÊàêÂäü
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">ËÆ¢Âçï‰ø°ÊÅØ</h6>
                            <table class="table table-sm">
                                <tr><td>ËÆ¢ÂçïID:</td><td id="resultOrderId"></td></tr>
                                <tr><td>ËÆ¢ÂçïÂè∑:</td><td id="resultOrderNo"></td></tr>
                                <tr><td>ÊÄªÈáëÈ¢ù:</td><td id="resultTotalAmount"></td></tr>
                                <tr><td>ÊúçÂä°Êï∞Èáè:</td><td id="resultServiceCount"></td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">‰∏ã‰∏ÄÊ≠•Êìç‰Ωú</h6>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                ËÆ¢ÂçïÂ∑≤ÂàõÂª∫ÊàêÂäüÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®Ë∑≥ËΩ¨Âà∞ÊúçÂä°Ê¥æÂçïÁïåÈù¢ÔºåÊÇ®ÂèØ‰ª•‰∏∫ÊØè‰∏™ÊúçÂä°ÊåáÊ¥æÊìç‰Ωú‰∫∫Âëò„ÄÇ
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="showServiceAssignmentInterface(currentOrderId)" data-bs-dismiss="modal">
                        <i class="fas fa-tasks me-2"></i>ÂºÄÂßãÊ¥æÂçï
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Á®çÂêéÂ§ÑÁêÜ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊâπÈáèÊ¥æÂçïÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="batchAssignModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-tasks me-2"></i>ÊâπÈáèÊ¥æÂçï</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="batchAssignContainer">
                        <!-- ÊâπÈáèÊ¥æÂçïÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" onclick="confirmBatchAssign()">
                        <i class="fas fa-check me-2"></i>Á°ÆËÆ§ÊâπÈáèÊ¥æÂçï
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÂçèËÆÆÊ¥æÂçïÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="assignServiceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ÊúçÂä°Ê¥æÂçï - ÂçèËÆÆÂåπÈÖç</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- ËøõÂ∫¶ÊåáÁ§∫Âô® -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <div class="text-center" id="step1Indicator">
                                    <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">1</div>
                                    <div class="small mt-1">ÈÄâÊã©Êìç‰Ωú‰∫∫Âëò</div>
                                </div>
                                <div class="text-center" id="step2Indicator">
                                    <div class="rounded-circle bg-secondary text-white d-inline-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">2</div>
                                    <div class="small mt-1">ÂåπÈÖçÂçèËÆÆ</div>
                                </div>
                                <div class="text-center" id="step3Indicator">
                                    <div class="rounded-circle bg-secondary text-white d-inline-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">3</div>
                                    <div class="small mt-1">Á°ÆËÆ§Ê¥æÂçï</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form id="assignServiceForm">
                        <input type="hidden" id="serviceCodeInput" value="">
                        <input type="hidden" id="serviceNameInput" value="">
                        
                        <!-- Ê≠•È™§1: ÈÄâÊã©Êìç‰Ωú‰∫∫Âëò -->
                        <div id="assignStep1">
                            <div class="alert alert-primary">
                                <h6><i class="fas fa-user-check me-2"></i>ÈÄâÊã©Êìç‰Ωú‰∫∫Âëò</h6>
                                <div>ÊúçÂä°È°πÁõÆ: <strong id="assignServiceName">-</strong></div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">ÂÆ¢ÊúçÊåáÊ¥æÊìç‰Ωú‰∫∫Âëò</label>
                                <select class="form-select" id="operatorSelect" required onchange="loadMatchingProtocols()">
                                    <option value="">ËØ∑ÈÄâÊã©Ë¶ÅÊåáÊ¥æÁöÑÊìç‰Ωú‰∫∫Âëò</option>
                                </select>
                                <small class="text-muted">‰Ωú‰∏∫ÂÆ¢ÊúçÔºåÊÇ®ÈúÄË¶Å‰∏∫Ê≠§ÊúçÂä°ÈÄâÊã©ÂêàÈÄÇÁöÑÊìç‰Ωú‰∫∫ÂëòÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®ÂåπÈÖçÂèØÁî®ÁöÑÂÜÖÈÉ®ÂçèËÆÆ</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÂÆ¢ÊúçÊ¥æÂçïÂ§áÊ≥®</label>
                                <textarea class="form-control" id="assignmentNotes" rows="2" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÊ¥æÂçïÂ§áÊ≥®ÂíåË¶ÅÊ±Ç..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">È¢ÑËÆ°ÂÆåÊàêÊó∂Èó¥</label>
                                <input type="datetime-local" class="form-control" id="expectedCompleteTime">
                            </div>
                        </div>

                        <!-- Ê≠•È™§2: ÂçèËÆÆÂåπÈÖçÂíåÈÄâÊã© -->
                        <div id="assignStep2" style="display: none;">
                            <div class="alert alert-info">
                                <h6><i class="fas fa-handshake me-2"></i>Êô∫ËÉΩÂçèËÆÆÂåπÈÖç</h6>
                                <div>Ê≠£Âú®‰∏∫ <strong id="selectedOperatorName">-</strong> ÂåπÈÖçÈÄÇÁî®ÁöÑÂÜÖÈÉ®ÂçèËÆÆ...</div>
                            </div>

                            <!-- ÂçèËÆÆÂåπÈÖçÁªìÊûú -->
                            <div id="protocolMatchResults" class="mb-3">
                                <!-- ÂåπÈÖçÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                            </div>

                            <!-- ÂçèËÆÆÈÄâÊã© -->
                            <div class="mb-3">
                                <label class="form-label">ÈÄâÊã©ÂÜÖÈÉ®ÂçèËÆÆ</label>
                                <select class="form-select" id="protocolSelect" required onchange="showProtocolDetails()">
                                    <option value="">ËØ∑ÈÄâÊã©ÂçèËÆÆ</option>
                                </select>
                                <small class="text-muted">Á≥ªÁªüÂ∑≤ÊåâÂåπÈÖçÂ∫¶Âíå‰Ω£ÈáëÁéáÊéíÂ∫èÔºåÂª∫ËÆÆÈÄâÊã©Êé®ËçêÂçèËÆÆ</small>
                            </div>

                            <!-- ÂçèËÆÆËØ¶ÊÉÖÂ±ïÁ§∫ -->
                            <div id="protocolDetails" style="display: none;">
                                <!-- ÂçèËÆÆËØ¶ÊÉÖÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                            </div>
                        </div>

                        <!-- Ê≠•È™§3: Á°ÆËÆ§Ê¥æÂçï -->
                        <div id="assignStep3" style="display: none;">
                            <div class="alert alert-success">
                                <h6><i class="fas fa-check-circle me-2"></i>ÂÆ¢ÊúçÊ¥æÂçï‰ø°ÊÅØÁ°ÆËÆ§</h6>
                                <small>ËØ∑Á°ÆËÆ§‰ª•‰∏ãÊåáÊ¥æ‰ø°ÊÅØÔºåÁ°ÆËÆ§ÂêéÂ∞ÜÊ≠£ÂºèÂ∞ÜÊúçÂä°Ê¥æÂçïÁªôÊìç‰Ωú‰∫∫Âëò</small>
                            </div>
                            
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 class="text-primary">Ê¥æÂçï‰ø°ÊÅØ</h6>
                                            <table class="table table-sm">
                                                <tr><td><strong>ÊúçÂä°È°πÁõÆ:</strong></td><td id="confirmServiceName">-</td></tr>
                                                <tr><td><strong>Êìç‰Ωú‰∫∫Âëò:</strong></td><td id="confirmOperatorName">-</td></tr>
                                                <tr><td><strong>È¢ÑËÆ°ÂÆåÊàêÊó∂Èó¥:</strong></td><td id="confirmExpectedTime">-</td></tr>
                                                <tr><td><strong>ÂÆ¢ÊúçÂ§áÊ≥®:</strong></td><td id="confirmAssignmentNotes">-</td></tr>
                                            </table>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="text-success">ÂçèËÆÆ‰ø°ÊÅØ</h6>
                                            <table class="table table-sm">
                                                <tr><td><strong>ÂçèËÆÆÂêçÁß∞:</strong></td><td id="confirmProtocolName">-</td></tr>
                                                <tr><td><strong>Âü∫Á°Ä‰Ω£ÈáëÁéá:</strong></td><td id="confirmBaseCommission">-</td></tr>
                                                <tr><td><strong>Áª©ÊïàÂ•ñÈáëÁéá:</strong></td><td id="confirmBonusCommission">-</td></tr>
                                                <tr><td><strong>ÈÄÇÁî®ËåÉÂõ¥:</strong></td><td id="confirmProtocolScope">-</td></tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="prevStepBtn" style="display: none;" onclick="previousAssignStep()">
                        <i class="fas fa-arrow-left me-2"></i>‰∏ä‰∏ÄÊ≠•
                    </button>
                    <button type="button" class="btn btn-primary" id="nextStepBtn" onclick="nextAssignStep()">
                        ‰∏ã‰∏ÄÊ≠•<i class="fas fa-arrow-right ms-2"></i>
                    </button>
                    <button type="button" class="btn btn-success" id="confirmAssignBtn" style="display: none;" onclick="confirmAssignment()">
                        <i class="fas fa-check me-2"></i>Á°ÆËÆ§Ê¥æÂçï
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊúçÂä°ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="serviceDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ÊúçÂä°ËØ¶ÊÉÖ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="serviceDetailContent">
                    <!-- ÊúçÂä°ËØ¶ÊÉÖÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÂçèËÆÆËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="protocolDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-handshake me-2"></i>ÂÜÖÈÉ®ÂçèËÆÆËØ¶ÊÉÖ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">ÂçèËÆÆÂü∫Êú¨‰ø°ÊÅØ</h6>
                            <table class="table table-sm">
                                <tr><td>ÂçèËÆÆÁºñÂè∑:</td><td id="protocolDetailsId"></td></tr>
                                <tr><td>ÂçèËÆÆÂêçÁß∞:</td><td id="protocolDetailsName"></td></tr>
                                <tr><td>ÈîÄÂîÆÈÉ®Èó®:</td><td id="protocolDetailsSalesDept"></td></tr>
                                <tr><td>Êìç‰ΩúÈÉ®Èó®:</td><td id="protocolDetailsOperationDept"></td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">ÂàÜÊ∂¶ËßÑÂàô</h6>
                            <table class="table table-sm">
                                <tr><td>Âü∫Êú¨‰Ω£ÈáëÁéá:</td><td id="protocolDetailsBaseCommission"></td></tr>
                                <tr><td>Áª©ÊïàÂ•ñÈáëÁéá:</td><td id="protocolDetailsPerformanceBonus"></td></tr>
                                <tr><td>ÁîüÊïàÊó•Êúü:</td><td id="protocolDetailsEffective"></td></tr>
                                <tr><td>ËøáÊúüÊó•Êúü:</td><td id="protocolDetailsExpiry"></td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-primary">ÂçèËÆÆËØ¥Êòé</h6>
                            <p id="protocolDetailsDescription" class="text-muted"></p>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Ê≥®ÊÑè:</strong> Êìç‰Ωú‰∫∫ÂëòÊé•ÂçïÊó∂ÈúÄË¶ÅÁ°ÆËÆ§Ê≠§ÂçèËÆÆÊù°Ê¨æÔºåÂçèËÆÆ‰∏ÄÊó¶Á°ÆËÆ§Â∞Ü‰Ωú‰∏∫ÂàÜÊ∂¶ËÆ°ÁÆóÁöÑ‰æùÊçÆ„ÄÇ
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ê®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-eye me-2"></i>ËÆ¢ÂçïËØ¶ÊÉÖ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="orderDetailContent">
                    <!-- Âä®ÊÄÅÂä†ËΩΩËÆ¢ÂçïËØ¶ÊÉÖ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="executeOrderClearing()">
                        <i class="fas fa-coins me-2"></i>ÊâßË°åÊ∏ÖÂàÜ
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/user-state.js"></script>
    <script src="js/global-user-manager.js"></script>
    <script src="js/permission-manager.js?v=20250920-1952"></script>
    <script src="js/protocol-manager.js?v=20250920-2200"></script>
    <script src="js/freight-order.js?v=20250921-2010"></script>
    <!-- ‰∏¥Êó∂Ê≥®ÈáäÂÖ∂‰ªñJSÊñá‰ª∂ÊéíÊü•ÈóÆÈ¢ò -->
    <!-- <script src="js/customer-service.js"></script> -->
    <script src="js/service-assignment.js?v=20250919-1805"></script>
    <script>
        // ÂÖ®Â±ÄÁî®Êà∑ÂàáÊç¢ÂäüËÉΩ
        function handleGlobalUserSwitch() {
            const select = document.getElementById('globalUserSwitchSelect');
            const selectedUserId = select.value;
            const selectedUserText = select.options[select.selectedIndex].text;
            
            console.log('ÂÖ®Â±ÄÁî®Êà∑ÂàáÊç¢:', selectedUserText);
            
            // Êõ¥Êñ∞UserStateÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            if (typeof UserState !== 'undefined') {
                const userMap = {
                    'CS001': { id: 'CS001', name: 'Âº†ÁæéÂçé', department: 'ÂÆ¢ÊúçÈÉ®', role: 'CUSTOMER_SERVICE' },
                    'OP001': { id: 'OP001', name: 'ÈôàÂ∏àÂÇÖ', department: 'Êµ∑ËøêÊìç‰Ωú', role: 'OPERATOR' },
                    'OP002': { id: 'OP002', name: 'ÊûóÊìç‰Ωú', department: 'Á©∫ËøêÊìç‰Ωú', role: 'OPERATOR' },
                    'OP003': { id: 'OP003', name: 'Âº†Êìç‰Ωú', department: 'ÈôÜËøêÊìç‰Ωú', role: 'OPERATOR' },
                    'MGR001': { id: 'MGR001', name: 'ÊùéÁªèÁêÜ', department: 'ÁÆ°ÁêÜÂ±Ç', role: 'MANAGER' },
                    'FIN001': { id: 'FIN001', name: 'Áéã‰ºöËÆ°', department: 'Ë¥¢Âä°ÈÉ®', role: 'FINANCE' }
                };
                
                const selectedUser = userMap[selectedUserId];
                if (selectedUser) {
                    UserState.setCurrentUser(selectedUser);
                    console.log('UserStateÂ∑≤Êõ¥Êñ∞:', selectedUser);
                }
            }
            
            // ÈÄöÁü•ÊâÄÊúâiframeÊõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                try {
                    if (iframe.contentWindow && iframe.contentWindow.postMessage) {
                        iframe.contentWindow.postMessage({
                            type: 'USER_SWITCH',
                            userId: selectedUserId,
                            userText: selectedUserText
                        }, '*');
                    }
                } catch (e) {
                    console.log('Êó†Ê≥ïÂêëiframeÂèëÈÄÅÊ∂àÊÅØ:', e.message);
                }
            });
            
            // Êõ¥Êñ∞ÂΩìÂâçÈ°µÈù¢ÁöÑÁî®Êà∑Áõ∏ÂÖ≥ÂÜÖÂÆπ
            if (typeof window.switchUser === 'function') {
                window.switchUser(selectedUserId);
            }
            
            // ÊòæÁ§∫ÂàáÊç¢ÊàêÂäüÊèêÁ§∫
            if (typeof showNotification === 'function') {
                showNotification(`Â∑≤ÂàáÊç¢Âà∞Áî®Êà∑: ${selectedUserText}`, 'success');
            }
        }

        // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
        function updateGlobalTime() {
            const timeElement = document.getElementById('globalCurrentTime');
            if (timeElement) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                timeElement.textContent = timeString;
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('OneOrder‰∏ªÁ≥ªÁªüÈ°µÈù¢Âä†ËΩΩÂÆåÊàê');
            
            // ÂàùÂßãÂåñÊó∂Èó¥ÊòæÁ§∫
            updateGlobalTime();
            setInterval(updateGlobalTime, 1000);
            
            // ÂàùÂßãÂåñËÆ¢ÂçïÊï∞ÊçÆÂä†ËΩΩ  
            setTimeout(() => {
                if (typeof loadOrdersData === 'function') {
                    loadOrdersData();
                } else if (typeof loadOrders === 'function') {
                    loadOrders();
                } else {
                    console.log('Á≠âÂæÖJSÊñá‰ª∂Âä†ËΩΩÂÆåÊàê...');
                }
                
                // ÁªëÂÆöÁî®Êà∑ÂàáÊç¢‰∫ã‰ª∂Ôºà‰øùÊåÅÂêëÂêéÂÖºÂÆπÔºâ
                const userSelect = document.getElementById('userSwitchSelect');
                if (userSelect && typeof window.switchUser === 'function') {
                    userSelect.addEventListener('change', function() {
                        window.switchUser(this.value);
                    });
                }
            }, 100);
        });
    </script>
    
    <!-- ÂÖ®Â±ÄÈÄöÁü•Á≥ªÁªü -->
    <script src="js/notification-system.js"></script>
    <script>
        // Á≠âÂæÖÂÖ®Â±ÄÈÄöÁü•Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàê
        document.addEventListener('DOMContentLoaded', function() {
            // Á≠âÂæÖÈÄöÁü•Á≥ªÁªüÂä†ËΩΩÂÆåÊàê
            setTimeout(() => {
                if (typeof notificationSystem !== 'undefined' && notificationSystem) {
                    console.log('ÈÄöÁü•Á≥ªÁªüÂ∑≤ÂàùÂßãÂåñÔºåËÆæÁΩÆÂÖ®Â±ÄËÆ°Êï∞ÂêåÊ≠•');
                    
                    // ÁõëÂê¨ÈÄöÁü•ËÆ°Êï∞ÂèòÂåñÂπ∂ÂêåÊ≠•Âà∞ÂÖ®Â±ÄÈÄöÁü•ÊåâÈíÆ
                    const originalUpdateBadge = notificationSystem.updateNotificationBadge;
                    notificationSystem.updateNotificationBadge = function() {
                        originalUpdateBadge.call(this);
                        
                        // ÂêåÊ≠•Âà∞ÂÖ®Â±ÄÈÄöÁü•ÊåâÈíÆ
                        const globalCount = document.getElementById('globalNotificationCount');
                        const serviceCount = document.getElementById('notificationCount');
                        
                        if (globalCount && serviceCount) {
                            globalCount.textContent = serviceCount.textContent;
                            globalCount.style.display = serviceCount.style.display;
                        }
                    };
                } else {
                    console.warn('ÈÄöÁü•Á≥ªÁªüÊú™ÂàùÂßãÂåñ');
                }
            }, 1000);
        });
    </script>
</body>
</html>
